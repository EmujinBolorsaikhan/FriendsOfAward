@page "/login"
@using Microsoft.AspNetCore.Components.Authorization 
@inject NavigationManager MyNavMgr
@inject MyCustomAuthStateProvider MyAuthStateProvider
@rendermode InteractiveServer

<AuthorizeView> 
    <Authorized> 
        @{ 
            // ja, man kann hier direkt C#-Code einfügen
            string name = "unknown";
            if (context.User.Identity != null)
                name = $"{context.User.Identity.Name}";
        } 
        <h3>Willkommen, @name</h3>
        <button @onclick="Btn_Logout">Logout</button>
    </Authorized> 

    <NotAuthorized> 
        <div class="login-container">
            <div class="login-box">
                <img src="/images/Logo.png" alt="Logo" class="login-logo" />

                <h2>Admin Login</h2>

                <!-- EMAIL ERROR -->
                @if (!string.IsNullOrEmpty(EmailError))
                {
                    <div class="error-message">@EmailError</div>
                }

                <div class="input-group">
                    <input id="email"
                           type="text"
                           placeholder="Email"
                           @bind="Email" />
                </div>

                <!-- PASSWORD ERROR -->
                @if (!string.IsNullOrEmpty(PasswordError))
                {
                    <div class="error-message">@PasswordError</div>
                }

                <div class="input-group">
                    <input id="password"
                           type="password"
                           placeholder="Passwort"
                           @bind="Password" />
                </div>

                <button class="login-button" @onclick="Logins">Login</button>
            </div>
        </div>
    </NotAuthorized> 
</AuthorizeView>


@code {
    private string Email { get; set; }
    private string Password { get; set; }

    private string EmailError { get; set; }
    private string PasswordError { get; set; }

    // Hardcoded password for example purposes
    private const string CorrectPassword = "admin123";

    private void Logins()
    {
        EmailError = "";
        PasswordError = "";

        bool hasError = false;

        if (string.IsNullOrWhiteSpace(Email))
        {
            EmailError = "Bitte Email eingeben.";
            hasError = true;
        }
        else if (!Email.Contains('@'))
        {
            EmailError = "Bitte geben Sie eine gültige Email ein.";
            hasError = true;
        }

        if (string.IsNullOrWhiteSpace(Password))
        {
            PasswordError = "Bitte geben Sie Ihr Passwort ein.";
            hasError = true;
        }
        else if (Password != CorrectPassword)
        {
            PasswordError = "Falsches Passwort.";
            hasError = true;
        }

        if (!hasError)
        {
            // TODO: redirect or open admin area
        }
    }

    void Btn_Login()
    {
        MyNavMgr.NavigateTo("/Login");
    }
    void Btn_Logout()
    {
        if (MyAuthStateProvider != null)
            MyAuthStateProvider.Logout();
        else
            Console.WriteLine("Fatal Error: AuthProvider == null!!");
    }
}
